{% extends 'base.html' %}

{% block title %}Chat with {{ other_user.username }}{% endblock %}

{% block content %}
<div class="min-h-screen p-4">
    <div class="max-w-2xl mx-auto">
        <div class="flex items-center mb-4">
            <a href="{% url 'communications:admin_messages' %}" class="text-gray-500 hover:text-gray-700 mr-3">
                <i class="fas fa-arrow-left"></i>
            </a>
            <h1 class="text-xl font-bold">Chat with {{ other_user.username }}</h1>
        </div>
        
        <!-- Chat Box -->
        <div class="bg-white rounded-lg shadow-lg border">
            <!-- Chat Header -->
            <div class="bg-gray-50 px-4 py-3 border-b rounded-t-lg">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold">
                        {{ other_user.username|first|upper }}
                    </div>
                    <div>
                        <div class="font-medium">{{ other_user.username }}</div>
                        <div class="text-xs text-gray-500">{{ other_user.get_full_name|default:"Student" }}</div>
                    </div>
                </div>
            </div>
            
            <!-- Messages Area -->
            <div class="h-96 overflow-y-auto p-4 space-y-3" id="messages-container">
                {% if messages %}
                    {% for message in messages %}
                        <div class="flex {% if message.sender == request.user %}justify-end{% else %}justify-start{% endif %}">
                            <div class="max-w-xs px-3 py-2 rounded-lg text-sm
                                {% if message.sender == request.user %}
                                    bg-blue-500 text-white
                                {% else %}
                                    bg-gray-200 text-gray-800
                                {% endif %}">
                                {{ message.content }}
                                <div class="text-xs mt-1 {% if message.sender == request.user %}text-blue-100{% else %}text-gray-500{% endif %}">
                                    {{ message.created_at|date:"g:i A" }}
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="text-center text-gray-500 py-8">
                        <div class="text-4xl mb-2">ðŸ’¬</div>
                        <p>No messages yet</p>
                    </div>
                {% endif %}
            </div>
            
            <!-- Message Input -->
            <div class="border-t p-4">
                <form method="post" class="flex space-x-2">
                    {% csrf_token %}
                    <input type="text" name="content" placeholder="Type your message..." 
                           class="flex-1 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
                        Send
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const container = document.getElementById('messages-container');
    container.scrollTop = container.scrollHeight;
});
</script>
{% endblock %}